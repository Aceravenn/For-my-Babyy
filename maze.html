<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tricky Heart Maze â€“ Dynamic</title>
<style>
body {
  font-family: system-ui, sans-serif;
  display: flex;
  flex-direction: column;
  align-items: center;
  background: #ffe4f0;
  margin: 0;
  padding: 20px;
  color: #be123c;
}
h1 { margin-bottom: 10px; }
p { margin-bottom: 10px; }

#maze {
  display: grid;
  grid-template-rows: repeat(15, 40px);
  grid-template-columns: repeat(15, 40px);
  gap: 2px;
  margin-top: 20px;
}

.cell {
  width: 40px;
  height: 40px;
  background: #fff;
  border: 1px solid #f97373;
  box-sizing: border-box;
  border-radius: 8px;
  position: relative;
}

.wall { background: #f97373; border-radius: 4px; }

.start { background: #facc15; display: flex; align-items: center; justify-content: center; }
.end { background: #34d399; display: flex; align-items: center; justify-content: center; }

/* Player heart */
.player {
  width: 30px;
  height: 30px;
  position: relative;
  display: inline-block;
  transform: rotate(-45deg);
  margin: auto;
  animation: beat 0.3s ease-in-out;
  z-index: 2;
}
.player::before,
.player::after {
  content: "";
  position: absolute;
  width: 30px;
  height: 30px;
  background: #fff;
  border-radius: 50%;
}
.player::before { top: -15px; left: 0; }
.player::after { left: 15px; top: 0; }

/* Heart beat */
@keyframes beat {
  0% { transform: rotate(-45deg) scale(1); }
  50% { transform: rotate(-45deg) scale(1.2); }
  100% { transform: rotate(-45deg) scale(1); }
}

/* Sparkle */
.sparkle {
  position: absolute;
  width: 8px;
  height: 8px;
  background: #facc15;
  border-radius: 50%;
  opacity: 0.8;
  pointer-events: none;
  animation: fade 0.6s forwards;
}
@keyframes fade {
  0% { transform: scale(1) translate(0,0); opacity:0.8; }
  100% { transform: scale(1.5) translate(var(--dx), var(--dy)); opacity:0; }
}
</style>
</head>
<body>

<h1>Tricky Heart Maze</h1>
<p>Find your way! Watch out for fake exits!</p>

<div id="maze"></div>

<script>
const ROWS = 15;
const COLS = 15;
const maze = document.getElementById('maze');
let mazeLayout = [];
let playerPos = {x:0,y:0};
let exitPos = {x:14, y:13}; // real exit

// Build maze grid
function buildMazeGrid() {
  maze.innerHTML = '';
  for(let r=0;r<ROWS;r++){
    for(let c=0;c<COLS;c++){
      const div = document.createElement('div');
      div.classList.add('cell');
      if(mazeLayout[r][c]===1) div.classList.add('wall');
      if(r===playerPos.y && c===playerPos.x){
        const player = document.createElement('div');
        player.classList.add('player');
        div.appendChild(player);
      }
      if(r===exitPos.y && c===exitPos.x){
        div.classList.add('end');
      }
      maze.appendChild(div);
      div.dataset.row=r;
      div.dataset.col=c;
    }
  }
}

// Generate new maze layout (simple random walls)
function generateMaze() {
  mazeLayout = [];
  for(let r=0;r<ROWS;r++){
    const row=[];
    for(let c=0;c<COLS;c++){
      if(Math.random()<0.25) row.push(1);
      else row.push(0);
    }
    mazeLayout.push(row);
  }
  // Ensure player position and exit are empty
  mazeLayout[playerPos.y][playerPos.x]=0;
  mazeLayout[exitPos.y][exitPos.x]=0;
}

// Create sparkle at given cell
function createSparkle(cellDiv){
  const s = document.createElement('div');
  s.classList.add('sparkle');
  s.style.setProperty('--dx', `${(Math.random()-0.5)*40}px`);
  s.style.setProperty('--dy', `${(Math.random()-0.5)*40}px`);
  cellDiv.appendChild(s);
  setTimeout(()=>s.remove(),600);
}

// Initial maze
generateMaze();
buildMazeGrid();

// Movement
document.addEventListener('keydown', e=>{
  let newX=playerPos.x;
  let newY=playerPos.y;
  if(e.key==='ArrowUp') newY--;
  if(e.key==='ArrowDown') newY++;
  if(e.key==='ArrowLeft') newX--;
  if(e.key==='ArrowRight') newX++;

  if(newX<0||newY<0||newY>=ROWS||newX>=COLS) return;
  if(mazeLayout[newY][newX]===1) return;

  playerPos={x:newX,y:newY};

  // Reconstruct maze if player near exit
  if(Math.abs(playerPos.x-exitPos.x)<=1 && Math.abs(playerPos.y-exitPos.y)<=1){
    generateMaze();
    mazeLayout[playerPos.y][playerPos.x]=0; // ensure player not blocked
    mazeLayout[exitPos.y][exitPos.x]=0; // ensure exit reachable
  }

  buildMazeGrid();

  // Add sparkle
  const playerCell = maze.querySelector(`.cell[data-row='${playerPos.y}'][data-col='${playerPos.x}']`);
  if(playerCell) createSparkle(playerCell);

  // Win
  if(playerPos.x===exitPos.x && playerPos.y===exitPos.y){
    setTimeout(()=>alert("Congratulations! Your heart reached the real exit!"),100);
  }
});
</script>

</body>
</html>